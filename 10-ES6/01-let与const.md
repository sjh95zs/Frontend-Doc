# let 与 const

> 参考：http://es6.ruanyifeng.com/#docs/let

### var 和 let/const 的区别

1. 块级作用域：大括号`{ }`

   - 背景：ES5 只有全局作用域和函数作用域，没有块级作用域
   - 所产生的问题：

     1. 内层变量可能覆盖外层变量
     2. 用来计数的循环变量泄露为全局变量

   - 如果需要在块级作用域内声明函数，最好使用匿名函数的形式：

     ```js
     if (true) {
       let a = function() {}; // 作用域为块级 令声明的函数作用域范围更清晰
     }
     ```

2. 不存在变量提升：为了减少运行时错误，防止在变量声明前就使用这个变量，从而导致意料之外的行为

3. 暂时性死区：为了减少运行时错误，防止在变量声明前就使用这个变量，从而导致意料之外的行为

4. 不可重复声明

5. let、const 声明的全局变量不会挂在顶层对象下面

   - 顶层对象，在浏览器环境指的是 window 对象，在 Node 指的是 global 对象。ES5 之中，顶层对象的属性与全局变量是等价的（不好的）
   - var 命令和 function 命令声明的全局变量，依旧是顶层对象的属性；相反 ES6，let 命令、const 命令、class 命令声明的全局变量，不属于顶层对象的属性。也就是说，从 ES6 开始，全局变量将逐步与顶层对象的属性脱钩

   ```js
   var a = 1;
   // 如果在 Node环境，可以写成 global.a
   // 或者采用通用方法，写成 this.a
   window.a; // 1

   let b = 1;
   window.b; // undefined
   ```

### const 命令两个注意点：

1. 一旦声明，必须马上赋值，否则会报错
2. 一旦声明值就不能改变：
   1. 值类型：不能改变
   2. 引用类型：变量指针不能变，数据还是可以改变的
      - 可以使用`Object.freeze(引用类型名)`来冻结，使它的数据都不能改变

### let、const 使用场景

1. let 使用场景：**完全取代 var**
2. const 使用场景：**常量**、**引用数据类型**
3. const 优点：
   - const 可以提醒阅读程序的人，这个变量不应该改变
   - const 比较符合函数式编程思想，运算不改变值，只是新建值，而且这样也有利于将来的分布式运算
   - JavaScript 编译器会对 const 进行优化，所以多使用 const，有利于提高程序的运行效率，也就是说 let 和 const 的本质区别，其实是编译器内部的处理不同
   - JavaScript 可能会有多线程的实现（比如 Intel 公司的 River Trail 那一类的项目），这时 let 表示的变量，只应出现在单线程运行的代码中，不能是多线程共享的，这样有利于保证线程安全

#### 补充：ES6 声明变量的 6 种方法

> var、function、let、const、import、class
